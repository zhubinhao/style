<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />	
		<link rel="stylesheet" type="text/css" href="../../css/style.css"/> 
		<style>

		</style>
	</head>     
	<body id="list">
		<header class="mui-bar mui-bar-nav">
	        <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" href="#item1mobile"></a>
	        <h1 class="mui-title">{{title}}</h1>
        </header>
       <div class="top">
    		<div v-on:tap='seach()'><i class="mui-icon mui-icon-search"></i>搜索</div>
    		<div v-on:tap='filre()'><i class="iconfont icon-shaixuan"></i>筛选</div>       		  
    	</div>
        <div class="mui-content" id="refreshContainer"  v-cloak>          	
				<ul class="mui-table-view" style='margin-top: 45px;padding: 0;'> 
					<div class="postions" v-if='mWhere'>筛选条件：{{mWhere}} <i class="mui-icon mui-icon-close postions-x" v-on:tap='close()'></i></div>
			        <div style="height: 30px;"v-if='mWhere'></div>
			        <li class="mui-table-view-cell" v-for='i in itm' 
			        	v-on:tap="list(i.wfdata_list_sid,i.mod_name,i.bill_title,i.arrive_date,i.start_human,i.start_mbsdept_name,i.start_date,i.bill_sid)">
			            <div class="mui-table">
			                <div class="mui-table-cell mui-col-xs-11 "> 
			                    <p class="mui-ellipsis" style="color: black;overflow: hidden;">业务名称：{{i.mod_name}}</p>
			                     <h5><span style="color: black;">业务说明：</span>{{i.bill_title}}</h5>	
			                    <h5><span style="color: black;">到达时间：</span>{{i.arrive_date}}</h5>				                    
			                    <h5><span style="color: black;">发&nbsp;&nbsp;起&nbsp;&nbsp;人：</span>{{i.start_human}}</h5>
			                    <h5><span style="color: black;">发起部门：</span>{{i.start_mbsdept_name}}</h5>				                    
			                    <h5><span style="color: black;">发起时间：</span>{{i.start_date}}</h5>	
			                </div>				                
			            </div>
			        </li>		
				</ul>		    					 	
		    <div style="text-align: center;line-height: 40px;color: gray;" id="inn"><div>
	    </div>       
		<script src="../../js/mui.min1.js"></script>
	    
        <script src="../../js/jquery-3.1.0.min .js"></script>
		<script src="../../js/api.js"></script>		
		<script src="../../js/vue.js"></script>

		<script type="text/javascript">
		var deceleration = mui.os.ios?44.003:0.0009;	
		var seachView,flireView,styles,extra=null;
		
			var list = new Vue({
				el:"#list",
				data:{
					title:'',
					type:'',
					human_sid:'',
					i:0,
					itm:[],
					sWhere:'',
					zWhere:'',
					mWhere:'',
					isTTrue:false,
					arr:[]
				},
				ready:function(){
					var serf = this;
					mui.init({
						swipeBack:true, 
							  pullRefresh : {
						      container:"#refreshContainer",//下拉刷新容器标识，querySelector能定位的css选择器均可，比如：id、.class等
						       down : {
							      style:'circle',//必选，下拉刷新样式，目前支持原生5+ ‘circle’ 样式
							      color:'#2BD009', //可选，默认“#2BD009” 下拉刷新控件颜色
							      height:'50px',//可选,默认50px.下拉刷新控件的高度,
							      range:'100px', //可选 默认100px,控件可下拉拖拽的范围
							      offset:'44px', //可选 默认0px,下拉刷新控件的起始位置
							      auto: true,//可选,默认false.首次加载自动上拉刷新一次							      
							      callback :serf.cont
							    },
						      up : { 
							      height:'50px', 					       
								  contentrefresh : "正在加载...",//可选，正在加载状态时，上拉加载控件上显示的标题内容
			                      contentnomore:'没有更多数据了',//可选，请求完毕若没有更多数据时显示的提醒内容；	

							      callback :serf.up //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
						       }
						   }
			
				    });
				   
					mui.plusReady(function(){											
						var selfff = plus.webview.currentWebview();
						serf.mWhere = plus.storage.getItem("mWhere")

						if(serf.mWhere==null){
							serf.mWhere=''
						}
//						console.log(serf.mWhere)
						
						serf.title=selfff.title; 
						serf.type=selfff.ID;
						serf.human_sid=plus.storage.getItem("human_sid");	
//						console.log(selfff.id);console.log(serf.type)
						 mui.back=function(){
						 	plus.storage.removeItem('mWhere');
						 	var ii =  plus.webview.getWebviewById('flire');
						 	if(ii!=null){
						 	ii.close("none")						 		
						 	}
						 	var jj =  plus.webview.getWebviewById('seachs');
						 	if(jj!=null){
						 	jj.close("none")
						 		
						 	}
				    	    selfff.close()
				       }
						api.getDataMod(serf.human_sid,serf.type,function(res){							
//							console.log(res) 
							serf.arr=JSON.parse(JSON.parse(res).result).records;							
						}) 
						styles={
					     	top:'45px',
							bottom:'0px',
							zindex: 2222,
						}
					})
				},
				methods:{
//					加载更多
					up:function(){	  					
						this.i++;	
						this.countlist('up')				     								        					
					},
					//刷新
					cont:function(){						
						this.i=1;
						this.countlist('down')						
					},
					 //搜索
					seach:function(){	
						var that = this;
						seachView=plus.webview.create('seach.html','seachs',styles,{ids:'list',name:'list',human_sid:that.human_sid,type:that.type,to:'listxq',title:that.title})
						seachView.show()
					},
                   //过滤
					filre:function(){
						var that=this;
						var itms = {
							 
					         types:that.arr
					         }
						flireView=plus.webview.create('flire.html','flire',styles,{types:that.arr,ids:'list',name:'list'})
						flireView.show()												
					},
					//关闭帅选条件
					close:function(){
						plus.storage.removeItem('mWhere');
						plus.webview.currentWebview().reload(true)
							
					},
					countlist:function(type){
						var serf =this;	
						var MWhere = serf.mWhere.replace(/\//g, '*');
						console.log(MWhere)
					     api.countlist(serf.human_sid,serf.type,serf.i,serf.sWhere,serf.zWhere,MWhere,function(data,tp){
							mui('#refreshContainer').pullRefresh().endPulldown();										
					     		if(tp=='err'){
			                      	mui.toast("请检查您的网络")
			                      	return;
			                   } 	
					            var datas =JSON.parse(data).result[0];	
									serf.isTTrue=false;
					            
					            console.log(datas)
								if(datas==''){
									console.log(plus.storage.getItem("mWhere"))
									if(plus.storage.getItem("mWhere")!=null){
										if(serf.i==1){
                                          document.getElementById('inn').innerHTML='未搜到<span style="color:red">"'+plus.storage.getItem("mWhere")+'"</span>相关信息'
											
										}										
									}else{
                                          document.getElementById('inn').innerHTML='暂无数据...'
										
									}

					                mui('#refreshContainer').pullRefresh().endPullup(true); 						           
						            return;											
								}	
								console.log(data) 
							    var datajson =JSON.parse(datas).records
							    if(type=='up'){
	                         	   serf.itm.push.apply(serf.itm,datajson);			        				          						    	
							    }else{
							    	serf.itm=datajson
							    }

    				             var istrue=false ;									            
					            if(datajson.length!=10){

					            	istrue=true;
					            }								     
					            mui('#refreshContainer').pullRefresh().endPullup(istrue); 					            
					      })
						
					},
																																																			
					list:function(list_sid,mod_name,bill_title,arrive_date,start_human,start_mbsdept_name,start_date,bill_sid){
						var sef =this;
					 mui.openWindow({
					 	url:'listxq.html',
					 	id:'listxq',
					 	extras: {
								list_sids:list_sid,
								mod_names:mod_name,
								bill_titles:bill_title,
								arrive_dates:arrive_date,
								start_humans:start_human,
								start_mbsdept_names:start_mbsdept_name,
								start_dates:start_date,
								bill_sids:bill_sid,
								title:sef.title
							},
					 	show: {
									aniShow: 'slide-in-right'
								},
						waiting:{
					      autoShow:false,//自动显示等待框，默认为true					      
					      
					            }
					 })
						
					}
				}
			})
		</script>
	</body>

</html>